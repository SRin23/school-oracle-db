DROP TABLE EMP;
DROP TABLE DEPT;
DROP TABLE SALGRADE;
DROP TABLE LOCATIONS;

CREATE TABLE DEPT(
    DEPTNO NUMBER(2) PRIMARY KEY,
    DNAME VARCHAR2(14),
    LOC_CODE VARCHAR2(2) 
);

INSERT INTO DEPT VALUES (10, 'ACCOUNTING', 'A1');
INSERT INTO DEPT VALUES (20, 'RESEARCH',   'B1');
INSERT INTO DEPT VALUES (30, 'SALES',      'C1');
INSERT INTO DEPT VALUES (40, 'OPERATIONS', 'A1');
INSERT INTO DEPT VALUES (50, 'INSA', null);

CREATE TABLE EMP(
    EMPNO NUMBER(4) PRIMARY KEY,
    ENAME VARCHAR2(10),
    JOB VARCHAR2(9),
    MGR NUMBER(4),
    HIREDATE DATE,
    SAL NUMBER(7, 2),
    COMM NUMBER(7, 2),
    DEPTNO NUMBER(2) REFERENCES DEPT(DEPTNO)
);

INSERT INTO EMP VALUES
        (7369, 'SMITH',  'CLERK',     7902,
        TO_DATE('17-12-2010', 'DD-Mm-YYYY'),  800, NULL, 20);
INSERT INTO EMP VALUES
        (7499, 'ALLEN',  'SALESMAN',  7698,
        TO_DATE('20-02-2015', 'DD-mm-YYYY'), 1600,  300, 30);
INSERT INTO EMP VALUES
        (7521, 'WARD',   'SALESMAN',  7698,
        TO_DATE('22-02-2001', 'DD-Mm-YYYY'), 1250,  500, 30);
INSERT INTO EMP VALUES
        (7566, 'JONES',  'MANAGER',   7839,
        TO_DATE('2-04-1991', 'DD-Mm-YYYY'),  2975, NULL, 20);
INSERT INTO EMP VALUES
        (7654, 'M%%ARTIN', 'SALESMAN',  7698,
        TO_DATE('28-09-1990', 'DD-Mm-YYYY'), 1250, 1400, 30);
INSERT INTO EMP VALUES
        (7698, 'BLAKE',  'MANAGER',   7839,
        TO_DATE('1-05-1995', 'DD-Mm-YYYY'),  2850, NULL, 30);
INSERT INTO EMP VALUES
        (7782, 'CLARK',  'MANAGER',   7839,
        TO_DATE('9-01-2011', 'DD-Mm-YYYY'),  2450, NULL, 10);
INSERT INTO EMP VALUES
        (7788, 'SCOTT',  'ANALYST',   7566,
        TO_DATE('09-12-2002', 'DD-Mm-YYYY'), 3000, NULL, 20);
INSERT INTO EMP VALUES
        (7839, 'KING',   'PRESIDENT', NULL,
        TO_DATE('17-11-1991', 'DD-Mm-YYYY'), 5000, NULL, 10);
INSERT INTO EMP VALUES
        (7844, 'TURNER', 'SALESMAN',  7698,
        TO_DATE('8-09-1991', 'DD-Mm-YYYY'),  1500,    0, 30);
INSERT INTO EMP VALUES
        (7876, 'ADAMS',  'CLERK',     7788,
        TO_DATE('12-01-2003', 'DD-Mm-YYYY'), 1100, NULL, 20);
INSERT INTO EMP VALUES
        (7900, 'JAMES',  'CLERK',     7698,
        TO_DATE('3-12-1998', 'DD-Mm-YYYY'),   950, NULL, 30);
INSERT INTO EMP VALUES
        (7902, 'FORD',   'ANALYST',   7566,
        TO_DATE('3-12-2001', 'DD-Mm-YYYY'),  3000, NULL, 20);
INSERT INTO EMP VALUES
        (7934, 'MILLER', 'CLERK',     7782,
        TO_DATE('23-01-2020', 'DD-Mm-YYYY'), 1300, NULL, 10);

create table locations(
        loc_code  varchar2(2),
        city	varchar2(12) 
);
 
insert into locations values ('A1','SEOUL');
insert into locations values ('B1','DALLAS');
insert into locations values ('C1','CHICAGO');
insert into locations values ('D1','BOSTON');
 
CREATE TABLE SALGRADE(
    GRADE NUMBER(2),
    LOSAL NUMBER(8),
    HISAL NUMBER(8)
);

INSERT INTO SALGRADE VALUES (1,  700, 1200);
INSERT INTO SALGRADE VALUES (2, 1201, 1400);
INSERT INTO SALGRADE VALUES (3, 1401, 2000);
INSERT INTO SALGRADE VALUES (4, 2001, 3000);
INSERT INTO SALGRADE VALUES (5, 3001, 9999);

COMMIT;

--TABLE내 값 확인
SELECT * FROM EMP;
SELECT * FROM DEPT;
SELECT * FROM LOCATIONS;
SELECT * FROM SALGRADE;

--날짜 형식 확인 및 변환
SELECT VALUE
FROM NLS_SESSION_PARAMETERS
WHERE PARAMETER='NLS_DATE_FORMAT';

ALTER SESSION SET NLS_DATE_FORMAT = 'RR/MM/DD'; 
COMMIT;

--1번
SELECT ENAME 이름, SAL 급여, SAL* 12 연봉 
FROM EMP;

--2번
SELECT EMPNO, ENAME, SAL
FROM EMP
WHERE ENAME LIKE '_#%#%%' ESCAPE '#';

--3번
SELECT ENAME, JOB, SAL
FROM EMP
WHERE JOB = 'CLERK'
ORDER BY SAL DESC;

--4번
SELECT EMPNO 컬럼1, ENAME 컬럼2, 'Meister' 컬럼3, SAL 급여, 1000 컬럼5
FROM EMP;

--5번
SELECT ENAME, LENGTH(ENAME)
FROM EMP
WHERE LENGTH(ENAME) >= 6
ORDER BY LENGTH(ENAME);

--6번
SELECT ENAME, HIREDATE, SYSDATE, TRUNC(MONTHS_BETWEEN(SYSDATE,HIREDATE)) 근무월수
FROM EMP
ORDER BY 4 DESC;

--7번
SELECT ENAME, HIREDATE, TO_CHAR(HIREDATE, 'DY')||'요일' "입사한 요일"
FROM EMP;

--8번
SELECT LAST_DAY(SYSDATE) - SYSDATE
FROM DUAL;

--9번
SELECT ENAME, TO_CHAR(HIREDATE, 'YYYY'), 
    CASE WHEN TO_CHAR(HIREDATE, 'YYYY') < 2000 THEN 900
    WHEN TO_CHAR(HIREDATE, 'YYYY') < 2010 THEN 200
    ELSE 0
    END COMM
FROM EMP;

--10번
SELECT COUNT(DISTINCT JOB)
FROM EMP;

--SELECT DISTINCT JOB
--FROM EMP;

--11번
SELECT DEPTNO, MIN(SAL)
FROM EMP
GROUP BY DEPTNO
ORDER BY 2 DESC;

--12번
SELECT TO_CHAR(HIREDATE, 'YYYY') "입사한 연도", TO_CHAR(MAX(SAL), '999,999') 최대월급
FROM EMP
WHERE TO_CHAR(HIREDATE, 'YYYY') <> 1991
GROUP BY TO_CHAR(HIREDATE, 'YYYY')
ORDER BY 최대월급 ASC;

--13번
SELECT JOB, SUM(SAL)
FROM EMP
WHERE JOB<>'SALESMAN'
GROUP BY JOB
HAVING SUM(SAL) >= 4000
ORDER BY 2 DESC;

--14번
SELECT JOB, COUNT(*)
FROM EMP
GROUP BY JOB
HAVING COUNT(*) >= 3;

--15번
SELECT TO_CHAR(HIREDATE, 'YYYY'), COUNT(*)
FROM EMP
GROUP BY TO_CHAR(HIREDATE, 'YYYY')
ORDER BY 1;

--16번
SELECT MAX(SUM(SAL))
FROM EMP
GROUP BY JOB;

--17번(FAIL)
SELECT SUM(SAL) "10", SUM(SAL) "20", SUM(SAL) "30"
FROM EMP
GROUP BY DEPTNO
ORDER BY DEPTNO;

SELECT SUM(SAL)
FROM EMP
GROUP BY DEPTNO
ORDER BY 1;

--18번(FAIL)
--입사연도 확인
SELECT DISTINCT TO_CHAR(HIREDATE, 'YYYY') FROM EMP
ORDER BY TO_CHAR(HIREDATE, 'YYYY');

--문제풀이
SELECT DEPTNO, TO_CHAR(HIREDATE, 'YYYY'), COUNT(*)
FROM EMP
GROUP BY CUBE(DEPTNO, TO_CHAR(HIREDATE, 'YYYY'));

--19번
SELECT JOB, SUM(SAL)
FROM EMP
GROUP BY ROLLUP(JOB);

--20번
SELECT ENAME, LOC_CODE
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO;

--21번
SELECT E.ENAME, E.JOB, E.SAL, D.LOC_CODE
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO AND JOB='SALESMAN';

--22번
SELECT E.ENAME, E.SAL, E.JOB, D.LOC_CODE
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO AND SAL BETWEEN 1000 AND 3000;

--23번 
SELECT E.ENAME, D.LOC_CODE
FROM EMP E, DEPT D, LOCATIONS L
WHERE E.DEPTNO = D.DEPTNO AND D.LOC_CODE = L.LOC_CODE AND L.CITY = 'SEOUL';

--24번
SELECT L.CITY, SUM(SAL)
FROM EMP E, DEPT D, LOCATIONS L
WHERE E.DEPTNO = D.DEPTNO AND D.LOC_CODE = L.LOC_CODE
GROUP BY L.CITY;

--25번
SELECT L.CITY, COUNT(*)
FROM EMP E, DEPT D, LOCATIONS L
WHERE E.DEPTNO = D.DEPTNO AND D.LOC_CODE = L.LOC_CODE
GROUP BY L.CITY
HAVING COUNT(*) >= 3
ORDER BY 2 DESC;

--26번
SELECT E.ENAME || ' (' || E.EMPNO || ') 관리자는 ' || M.ENAME || ' (' || M.EMPNO ||')' 관리자정보
FROM EMP E, EMP M
WHERE E.MGR = M.EMPNO
ORDER BY E.ENAME;

--27번
SELECT E.ENAME, E.SAL, S.GRADE
FROM EMP E, SALGRADE S
WHERE E.SAL BETWEEN S.LOSAL AND S.HISAL;

--28번
SELECT L.LOC_CODE,L.CITY, MAX(E.SAL), MIN(E.SAL)
FROM EMP E, DEPT D, LOCATIONS L
WHERE E.DEPTNO = D.DEPTNO AND D.LOC_CODE = L.LOC_CODE
GROUP BY L.LOC_CODE, L.CITY;

--29번
SELECT D.LOC_CODE, COUNT(*)
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO AND D.LOC_CODE <> 'A1'
GROUP BY D.LOC_CODE
HAVING COUNT(*) >= 3
ORDER BY 2 DESC;

--30번
SELECT D.DEPTNO, D.DNAME, D.LOC_CODE, L.CITY
FROM DEPT D, LOCATIONS L
WHERE D.LOC_CODE = L.LOC_CODE(+)
ORDER BY DEPTNO;
